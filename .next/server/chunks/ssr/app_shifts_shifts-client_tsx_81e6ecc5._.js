module.exports=[40047,a=>{"use strict";var b=a.i(353),c=a.i(42924),d=a.i(69767);function e(a){let b=a.getFullYear(),c=String(a.getMonth()+1).padStart(2,"0"),d=String(a.getDate()).padStart(2,"0");return`${b}-${c}-${d}`}function f(a,b){let c=new Date(a);return c.setDate(c.getDate()+b),c}function g(a){return new Intl.NumberFormat("ru-RU").format(a)+" ₽"}function h({days:a,value:c,onChange:e,hotDays:f,premiumDays:g}){return(0,b.jsxs)("div",{className:"rounded-2xl border border-zinc-200 bg-white p-3",children:[(0,b.jsx)("div",{className:"flex gap-2 overflow-x-auto pb-1 [-webkit-overflow-scrolling:touch]",children:a.map(a=>{let h=a===c,i=f?.has(a),j=g?.has(a);return(0,b.jsxs)("button",{onClick:()=>e(a),className:(0,d.cn)("relative min-w-[92px] flex-shrink-0 rounded-2xl border px-3 py-2 text-left transition",h?"border-zinc-900 bg-zinc-900 text-white":"border-zinc-200 bg-white text-zinc-800 hover:bg-zinc-50"),children:[(0,b.jsxs)("div",{className:"absolute right-2 top-2 flex items-center gap-1",children:[j?(0,b.jsx)("span",{className:(0,d.cn)("h-2 w-2 rounded-full",h?"bg-sky-300":"bg-sky-500"),"aria-label":"Высокий тариф",title:"Высокий тариф"}):null,i?(0,b.jsx)("span",{className:(0,d.cn)("h-2 w-2 rounded-full",h?"bg-red-300":"bg-red-500"),"aria-label":"Горящие слоты",title:"Горящие слоты"}):null]}),(0,b.jsx)("div",{className:(0,d.cn)("text-xs",h?"text-white/80":"text-zinc-500"),children:function(a){let[b,c,d]=a.split("-").map(Number),e=new Date(b,c-1,d);return new Intl.DateTimeFormat("ru-RU",{weekday:"short"}).format(e)}(a)}),(0,b.jsx)("div",{className:"mt-0.5 text-sm font-semibold",children:function(a){let[b,c,d]=a.split("-").map(Number),e=new Date(b,c-1,d);return new Intl.DateTimeFormat("ru-RU",{day:"numeric",month:"short"}).format(e)}(a)})]},a)})}),(0,b.jsxs)("div",{className:"mt-2 flex flex-wrap gap-3 px-1 text-[11px] text-zinc-500",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)("span",{className:"h-2 w-2 rounded-full bg-sky-500"})," высокий тариф"]}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)("span",{className:"h-2 w-2 rounded-full bg-red-500"})," горящие слоты"]})]})]})}var i=a.i(27690);function j(a){return{status:"none",updatedAt:0}}function k(a,b){}function l({slot:a,onBook:d}){let[e,f]=(0,c.useState)("none");(0,c.useEffect)(()=>{f(j(a.id).status)},[a.id]);let h=a.pay>=3500;return(0,b.jsxs)("div",{className:"rounded-2xl border border-zinc-200 bg-white p-5",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,b.jsx)("div",{className:"text-base font-semibold",children:a.title}),a.hot?(0,b.jsx)("span",{className:"inline-flex items-center rounded-full bg-red-50 px-2 py-0.5 text-xs font-medium text-red-700",children:"Горящий"}):null,h?(0,b.jsx)("span",{className:"inline-flex items-center rounded-full bg-sky-50 px-2 py-0.5 text-xs font-medium text-sky-700",children:"Высокий тариф"}):null,"booked"===e?(0,b.jsx)("span",{className:"inline-flex items-center rounded-full bg-emerald-50 px-2 py-0.5 text-xs font-medium text-emerald-700",children:"Записан"}):null,"cancelled"===e?(0,b.jsx)("span",{className:"inline-flex items-center rounded-full bg-zinc-100 px-2 py-0.5 text-xs font-medium text-zinc-600",children:"Отменено"}):null,"completed"===e?(0,b.jsx)("span",{className:"inline-flex items-center rounded-full bg-zinc-900 px-2 py-0.5 text-xs font-medium text-white",children:"Завершено"}):null]}),(0,b.jsxs)("div",{className:"mt-1 text-sm text-zinc-600",children:[a.company," · ",a.city]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("div",{className:"text-base font-semibold",children:g(a.pay)}),(0,b.jsx)("div",{className:"mt-1 text-xs text-zinc-500",children:a.time})]})]}),(0,b.jsx)("div",{className:"mt-3 flex flex-wrap gap-2",children:a.tags.map(a=>(0,b.jsx)(i.default,{children:a},a))}),(0,b.jsx)("div",{className:"mt-3 text-sm text-zinc-600",children:a.address}),"booked"===e?(0,b.jsxs)("div",{className:"mt-4 grid gap-2",children:[(0,b.jsx)("button",{onClick:()=>{k(a.id,"cancelled"),f("cancelled")},className:"inline-flex w-full items-center justify-center rounded-xl border border-zinc-200 bg-white px-4 py-3 text-sm font-medium text-zinc-900",children:"Отменить запись"}),(0,b.jsx)("button",{onClick:()=>{k(a.id,"completed"),f("completed")},className:"inline-flex w-full items-center justify-center rounded-xl bg-zinc-900 px-4 py-3 text-sm font-medium text-white",children:"Отметить как завершено (demo)"})]}):"completed"===e?(0,b.jsx)("div",{className:"mt-4 rounded-xl border border-zinc-200 bg-zinc-50 p-3 text-sm text-zinc-700",children:"Смена завершена. Оценка смены — в профиле."}):(0,b.jsx)("button",{onClick:()=>d(a),className:"mt-4 inline-flex w-full items-center justify-center rounded-xl bg-zinc-900 px-4 py-3 text-sm font-medium text-white",children:"Записаться"})]})}function m(a){let[b,c]=a.split("–").map(a=>a.trim()),[d,e]=(b??"00:00").split(":").map(Number),[f,g]=(c??"00:00").split(":").map(Number);return{start:60*(d||0)+(e||0),end:60*(f||0)+(g||0)}}function n(a,b){return a.start<b.end&&b.start<a.end}function o({open:a,onClose:d,days:e,slots:f,hotDays:i,premiumDays:l,initialDay:o,initialTitle:p}){let[q,r]=(0,c.useState)(o),[s,t]=(0,c.useState)([]),[u,v]=(0,c.useState)(!0),[w,x]=(0,c.useState)(null);(0,c.useEffect)(()=>{a&&(r(o),t([]),v(!0),x(null))},[a,o]);let y=(0,c.useMemo)(()=>f.filter(a=>a.date===q).sort((a,b)=>m(a.time).start-m(b.time).start),[f,q]),z=(0,c.useMemo)(()=>y.map(a=>a.id),[y]),A=(0,c.useMemo)(()=>{let a=new Map;for(let b of y)a.set(b.id,b);return a},[y]),B=(0,c.useMemo)(()=>s.map(a=>A.get(a)).filter(Boolean),[s,A]),C=(0,c.useMemo)(()=>B.reduce((a,b)=>a+b.pay,0),[B]),D=a=>"booked"===j(a).status,E=a=>{let b=A.get(a);if(!b)return!1;let c=m(b.time);for(let b of s){if(b===a)continue;let d=A.get(b);if(d&&n(c,m(d.time)))return!1}for(let b of y)if(D(b.id)&&b.id!==a&&n(c,m(b.time)))return!1;return!0},F=a=>{if(!u||0===s.length)return!0;let b=z.indexOf(a);if(-1===b)return!1;let c=s.map(a=>z.indexOf(a)).filter(a=>a>=0).sort((a,b)=>a-b),d=c[0],e=c[c.length-1];return b===d-1||b===e+1},G=a=>!!s.includes(a)||!D(a)&&!!E(a)&&!!F(a);return a?(0,b.jsxs)("div",{className:"fixed inset-0 z-50",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:d}),(0,b.jsx)("div",{className:"absolute left-1/2 top-4 w-[min(560px,calc(100%-16px))] -translate-x-1/2",children:(0,b.jsxs)("div",{className:"rounded-2xl border border-zinc-200 bg-white shadow-lg",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3 border-b border-zinc-200 p-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm text-zinc-500",children:"Запись на слоты"}),(0,b.jsx)("div",{className:"text-base font-semibold",children:p??"Выбери дату и слоты"})]}),(0,b.jsx)("button",{onClick:d,className:"rounded-xl border border-zinc-200 bg-white px-3 py-2 text-sm",children:"Закрыть"})]}),(0,b.jsxs)("div",{className:"space-y-3 p-4",children:[(0,b.jsx)(h,{days:e,value:q,onChange:a=>{r(a),t([]),x(null)},hotDays:i,premiumDays:l}),(0,b.jsxs)("div",{className:"flex items-center justify-between gap-3 rounded-2xl border border-zinc-200 bg-white p-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-medium",children:"Выбирать “подряд”"}),(0,b.jsx)("div",{className:"text-xs text-zinc-500",children:"Вкл — только соседние слоты, плюс запрет пересечений по времени."})]}),(0,b.jsx)("button",{onClick:()=>{v(a=>!a),t([]),x(null)},className:"rounded-xl border border-zinc-200 bg-white px-3 py-2 text-sm",children:u?"Вкл":"Выкл"})]}),w?(0,b.jsx)("div",{className:"rounded-2xl border border-rose-200 bg-rose-50 p-3 text-sm text-rose-800",children:w}):null,0===y.length?(0,b.jsx)("div",{className:"rounded-2xl border border-zinc-200 bg-white p-4 text-sm text-zinc-600",children:"На этот день слотов нет. Листай табы сверху."}):(0,b.jsx)("div",{className:"space-y-2",children:y.map(a=>{let c=s.includes(a.id),d=D(a.id),e=!c&&!G(a.id);return(0,b.jsx)("button",{onClick:()=>{var b;return b=a.id,void t(a=>a.includes(b)?(x(null),a.filter(a=>a!==b)):G(b)?(x(null),[...a,b]):(D(b)?x("Этот слот уже забронирован."):E(b)?F(b)?x("Нельзя выбрать этот слот."):x("В режиме “подряд” можно добавлять только соседние слоты (слева/справа)."):x("Нельзя выбрать: слот пересекается по времени с выбранным или уже забронированным."),a))},disabled:e,className:["w-full rounded-2xl border p-4 text-left transition",c?"border-zinc-900 bg-zinc-50":"border-zinc-200 hover:bg-zinc-50",e?"opacity-50 cursor-not-allowed":""].join(" "),title:d?"Уже записан на этот слот":void 0,children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:["inline-flex h-5 w-5 items-center justify-center rounded-md border text-xs",c?"border-zinc-900 bg-zinc-900 text-white":"border-zinc-300 bg-white"].join(" "),children:c?"✓":""}),(0,b.jsxs)("div",{className:"font-semibold",children:[a.title,a.hot?(0,b.jsx)("span",{className:"ml-2 text-xs text-red-600",children:"• горячий"}):null,a.pay>=3500?(0,b.jsx)("span",{className:"ml-2 text-xs text-sky-700",children:"• высокий тариф"}):null,d?(0,b.jsx)("span",{className:"ml-2 text-xs text-emerald-700",children:"• уже записан"}):null]})]}),(0,b.jsxs)("div",{className:"mt-1 text-sm text-zinc-600",children:[a.company," · ",a.city]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("div",{className:"text-sm font-semibold",children:a.time}),(0,b.jsx)("div",{className:"text-xs text-zinc-500",children:g(a.pay)})]})]})},a.id)})}),(0,b.jsxs)("div",{className:"rounded-2xl border border-zinc-200 bg-white p-4 text-sm",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-zinc-600",children:"Выбрано слотов:"}),(0,b.jsx)("span",{className:"font-semibold",children:s.length})]}),(0,b.jsxs)("div",{className:"mt-1 flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-zinc-600",children:"Итого оплата:"}),(0,b.jsx)("span",{className:"font-semibold",children:g(C)})]})]}),(0,b.jsxs)("button",{disabled:0===s.length,onClick:()=>{let a=B.map(a=>({id:a.id,r:m(a.time)}));for(let b=0;b<a.length;b++)for(let c=b+1;c<a.length;c++)if(n(a[b].r,a[c].r))return void x("Есть пересекающиеся по времени слоты. Убери конфликт и попробуй снова.");for(let a of s)k(a,"booked");d()},className:"inline-flex w-full items-center justify-center rounded-xl bg-zinc-900 px-4 py-3 text-sm font-medium text-white disabled:opacity-50",children:["Подтвердить запись (",s.length,")"]}),(0,b.jsx)("div",{className:"text-xs text-zinc-500",children:"UI-only: бронь сохраняется в localStorage. Пересечения по времени запрещены."})]})]})})]}):null}function p(){var a;let[d,g]=(0,c.useState)(""),[i,j]=(0,c.useState)(()=>new Date),[k,m]=(0,c.useState)(()=>e(new Date)),n=(0,c.useMemo)(()=>(function(a,b=14){let c=[];for(let d=0;d<b;d++)c.push(e(f(a,d)));return c})(i,14),[i]),p=(0,c.useMemo)(()=>(function(a,b=14){let c=[];for(let d=0;d<b;d++){let b=e(f(a,d)),g=d%4==0?0:d%2==0?2:1,h=d%3==0;for(let a=0;a<g;a++){let d=`${b}-slot-${a+1}`,e=h&&0===a,f=a%3,g=0===f?{title:"Повар-универсал",company:"Кафе «Лимон»",city:"Берлин",address:"Warschauer Str. 12",time:"10:00–19:00",pay:3500,tags:["Питание","Форма"]}:1===f?{title:"Официант",company:"Ресторан «Север»",city:"Берлин",address:"Prenzlauer Allee 77",time:"12:00–21:00",pay:2800,tags:["Чаевые","Обучение"]}:{title:"Кладовщик",company:"Склад «Nord»",city:"Потсдам",address:"Industriestr. 4",time:"08:00–17:00",pay:3200,tags:["Тёплый склад"]};c.push({id:d,date:b,hot:e,...g})}}return c})(i,14),[i]),q=(0,c.useMemo)(()=>{let a=new Set;for(let b of p)b.hot&&a.add(b.date);return a},[p]),r=(0,c.useMemo)(()=>{let a=new Set;for(let b of p)b.pay>=3500&&a.add(b.date);return a},[p]);a=(0,c.useCallback)(a=>{j(a),m(e(a))},[]),(0,c.useEffect)(()=>{let b=()=>a(new Date),c=new Date,d=new Date(c.getFullYear(),c.getMonth(),c.getDate()+1,0,0,2).getTime()-c.getTime(),e=window.setTimeout(()=>{b(),e._t2=window.setInterval(b,6e4)},d);return()=>{let a=e?._t2;a&&window.clearInterval(a),window.clearTimeout(e)}},[a]),(0,c.useEffect)(()=>{0!==n.length&&(n.includes(k)||m(n[0]))},[n,k]);let s=(0,c.useMemo)(()=>{let a=d.trim().toLowerCase();return p.filter(a=>a.date===k).filter(b=>!a||[b.title,b.company,b.city].some(b=>b.toLowerCase().includes(a)))},[d,k,p]),[t,u]=(0,c.useState)(!1),[v,w]=(0,c.useState)(null),x=(0,c.useCallback)(()=>u(!1),[]),y=(0,c.useCallback)(a=>{w({day:a.date,title:a.title}),u(!0)},[]);return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)(h,{days:n,value:k,onChange:m,hotDays:q,premiumDays:r}),(0,b.jsx)("div",{className:"rounded-2xl border border-zinc-200 bg-white p-4",children:(0,b.jsx)("input",{value:d,onChange:a=>g(a.target.value),placeholder:"Поиск: профессия, компания, город…",className:"w-full rounded-xl border border-zinc-200 bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-zinc-900/10"})}),0===s.length?(0,b.jsx)("div",{className:"rounded-2xl border border-zinc-200 bg-white p-5 text-sm text-zinc-600",children:"На выбранную дату слотов нет. Листай дни табами сверху."}):(0,b.jsx)("div",{className:"space-y-3",children:s.map(a=>(0,b.jsx)(l,{slot:a,onBook:y},a.id))}),(0,b.jsx)(o,{open:t,onClose:x,days:n,slots:p,hotDays:q,premiumDays:r,initialDay:v?.day??k,initialTitle:v?.title})]})}a.s(["default",()=>p],40047)}];

//# sourceMappingURL=app_shifts_shifts-client_tsx_81e6ecc5._.js.map