{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/smenuberu-web/lib/slots.ts"],"sourcesContent":["export type Slot = {\n  id: string;\n  date: string; // YYYY-MM-DD (local)\n  title: string;\n  company: string;\n  city: string;\n  address: string;\n  time: string; // \"10:00–19:00\"\n  pay: number;\n  hot?: boolean; // \"горящий слот\"\n  tags: string[];\n};\n\nexport function toISODateLocal(d: Date) {\n  const y = d.getFullYear();\n  const m = String(d.getMonth() + 1).padStart(2, \"0\");\n  const day = String(d.getDate()).padStart(2, \"0\");\n  return `${y}-${m}-${day}`;\n}\n\nexport function addDays(d: Date, n: number) {\n  const x = new Date(d);\n  x.setDate(x.getDate() + n);\n  return x;\n}\n\nexport function formatDayLabelRu(isoDate: string) {\n  const [y, m, d] = isoDate.split(\"-\").map(Number);\n  const date = new Date(y, m - 1, d);\n  return new Intl.DateTimeFormat(\"ru-RU\", { day: \"numeric\", month: \"short\" }).format(date);\n}\n\nexport function formatWeekdayShortRu(isoDate: string) {\n  const [y, m, d] = isoDate.split(\"-\").map(Number);\n  const date = new Date(y, m - 1, d);\n  return new Intl.DateTimeFormat(\"ru-RU\", { weekday: \"short\" }).format(date);\n}\n\nexport function formatMoneyRub(amount: number) {\n  return new Intl.NumberFormat(\"ru-RU\").format(amount) + \" ₽\";\n}\n\n// Генератор “условных” слотов на 14 дней вперёд.\n// Горячие слоты: каждый 3-й день, и ещё один случайный слот в этот день.\nexport function getMockSlots(start: Date, days = 14): Slot[] {\n  const out: Slot[] = [];\n\n  for (let i = 0; i < days; i++) {\n    const date = toISODateLocal(addDays(start, i));\n\n    // 0..2 слота в день (чтобы были пустые дни)\n    const count = (i % 4 === 0) ? 0 : (i % 2 === 0 ? 2 : 1);\n    const hotDay = i % 3 === 0; // условно “горящие дни”\n\n    for (let j = 0; j < count; j++) {\n      const id = `${date}-slot-${j + 1}`;\n      const hot = hotDay && j === 0; // первый слот в “горящий день” — горячий\n\n      const template = (j % 3);\n      const base =\n        template === 0\n          ? {\n              title: \"Повар-универсал\",\n              company: \"Кафе «Лимон»\",\n              city: \"Берлин\",\n              address: \"Warschauer Str. 12\",\n              time: \"10:00–19:00\",\n              pay: 3500,\n              tags: [\"Питание\", \"Форма\"]\n            }\n          : template === 1\n            ? {\n                title: \"Официант\",\n                company: \"Ресторан «Север»\",\n                city: \"Берлин\",\n                address: \"Prenzlauer Allee 77\",\n                time: \"12:00–21:00\",\n                pay: 2800,\n                tags: [\"Чаевые\", \"Обучение\"]\n              }\n            : {\n                title: \"Кладовщик\",\n                company: \"Склад «Nord»\",\n                city: \"Потсдам\",\n                address: \"Industriestr. 4\",\n                time: \"08:00–17:00\",\n                pay: 3200,\n                tags: [\"Тёплый склад\"]\n              };\n\n      out.push({\n        id,\n        date,\n        hot,\n        ...base\n      });\n    }\n  }\n\n  return out;\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAaO,SAAS,eAAe,CAAO;IACpC,MAAM,IAAI,EAAE,WAAW;IACvB,MAAM,IAAI,OAAO,EAAE,QAAQ,KAAK,GAAG,QAAQ,CAAC,GAAG;IAC/C,MAAM,MAAM,OAAO,EAAE,OAAO,IAAI,QAAQ,CAAC,GAAG;IAC5C,OAAO,GAAG,EAAE,CAAC,EAAE,EAAE,CAAC,EAAE,KAAK;AAC3B;AAEO,SAAS,QAAQ,CAAO,EAAE,CAAS;IACxC,MAAM,IAAI,IAAI,KAAK;IACnB,EAAE,OAAO,CAAC,EAAE,OAAO,KAAK;IACxB,OAAO;AACT;AAEO,SAAS,iBAAiB,OAAe;IAC9C,MAAM,CAAC,GAAG,GAAG,EAAE,GAAG,QAAQ,KAAK,CAAC,KAAK,GAAG,CAAC;IACzC,MAAM,OAAO,IAAI,KAAK,GAAG,IAAI,GAAG;IAChC,OAAO,IAAI,KAAK,cAAc,CAAC,SAAS;QAAE,KAAK;QAAW,OAAO;IAAQ,GAAG,MAAM,CAAC;AACrF;AAEO,SAAS,qBAAqB,OAAe;IAClD,MAAM,CAAC,GAAG,GAAG,EAAE,GAAG,QAAQ,KAAK,CAAC,KAAK,GAAG,CAAC;IACzC,MAAM,OAAO,IAAI,KAAK,GAAG,IAAI,GAAG;IAChC,OAAO,IAAI,KAAK,cAAc,CAAC,SAAS;QAAE,SAAS;IAAQ,GAAG,MAAM,CAAC;AACvE;AAEO,SAAS,eAAe,MAAc;IAC3C,OAAO,IAAI,KAAK,YAAY,CAAC,SAAS,MAAM,CAAC,UAAU;AACzD;AAIO,SAAS,aAAa,KAAW,EAAE,OAAO,EAAE;IACjD,MAAM,MAAc,EAAE;IAEtB,IAAK,IAAI,IAAI,GAAG,IAAI,MAAM,IAAK;QAC7B,MAAM,OAAO,eAAe,QAAQ,OAAO;QAE3C,4CAA4C;QAC5C,MAAM,QAAQ,AAAC,IAAI,MAAM,IAAK,IAAK,IAAI,MAAM,IAAI,IAAI;QACrD,MAAM,SAAS,IAAI,MAAM,GAAG,wBAAwB;QAEpD,IAAK,IAAI,IAAI,GAAG,IAAI,OAAO,IAAK;YAC9B,MAAM,KAAK,GAAG,KAAK,MAAM,EAAE,IAAI,GAAG;YAClC,MAAM,MAAM,UAAU,MAAM,GAAG,yCAAyC;YAExE,MAAM,WAAY,IAAI;YACtB,MAAM,OACJ,aAAa,IACT;gBACE,OAAO;gBACP,SAAS;gBACT,MAAM;gBACN,SAAS;gBACT,MAAM;gBACN,KAAK;gBACL,MAAM;oBAAC;oBAAW;iBAAQ;YAC5B,IACA,aAAa,IACX;gBACE,OAAO;gBACP,SAAS;gBACT,MAAM;gBACN,SAAS;gBACT,MAAM;gBACN,KAAK;gBACL,MAAM;oBAAC;oBAAU;iBAAW;YAC9B,IACA;gBACE,OAAO;gBACP,SAAS;gBACT,MAAM;gBACN,SAAS;gBACT,MAAM;gBACN,KAAK;gBACL,MAAM;oBAAC;iBAAe;YACxB;YAER,IAAI,IAAI,CAAC;gBACP;gBACA;gBACA;gBACA,GAAG,IAAI;YACT;QACF;IACF;IAEA,OAAO;AACT"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/smenuberu-web/components/day-tabs.tsx"],"sourcesContent":["\"use client\";\n\nimport { cn } from \"@/lib/cn\";\nimport { formatDayLabelRu, formatWeekdayShortRu } from \"@/lib/slots\";\n\ntype Props = {\n  days: string[];\n  value: string;\n  onChange: (iso: string) => void;\n  hotDays?: Set<string>;     // red notch\n  premiumDays?: Set<string>; // blue notch\n};\n\nexport default function DayTabs({ days, value, onChange, hotDays, premiumDays }: Props) {\n  return (\n    <div className=\"rounded-2xl border border-zinc-200 bg-white p-3\">\n      <div className=\"flex gap-2 overflow-x-auto pb-1 [-webkit-overflow-scrolling:touch]\">\n        {days.map((iso) => {\n          const active = iso === value;\n          const isHot = hotDays?.has(iso);\n          const isPremium = premiumDays?.has(iso);\n\n          return (\n            <button\n              key={iso}\n              onClick={() => onChange(iso)}\n              className={cn(\n                \"relative min-w-[92px] flex-shrink-0 rounded-2xl border px-3 py-2 text-left transition\",\n                active\n                  ? \"border-zinc-900 bg-zinc-900 text-white\"\n                  : \"border-zinc-200 bg-white text-zinc-800 hover:bg-zinc-50\"\n              )}\n            >\n              {/* notches */}\n              <div className=\"absolute right-2 top-2 flex items-center gap-1\">\n                {isPremium ? (\n                  <span\n                    className={cn(\"h-2 w-2 rounded-full\", active ? \"bg-sky-300\" : \"bg-sky-500\")}\n                    aria-label=\"Высокий тариф\"\n                    title=\"Высокий тариф\"\n                  />\n                ) : null}\n                {isHot ? (\n                  <span\n                    className={cn(\"h-2 w-2 rounded-full\", active ? \"bg-red-300\" : \"bg-red-500\")}\n                    aria-label=\"Горящие слоты\"\n                    title=\"Горящие слоты\"\n                  />\n                ) : null}\n              </div>\n\n              <div className={cn(\"text-xs\", active ? \"text-white/80\" : \"text-zinc-500\")}>\n                {formatWeekdayShortRu(iso)}\n              </div>\n              <div className=\"mt-0.5 text-sm font-semibold\">{formatDayLabelRu(iso)}</div>\n            </button>\n          );\n        })}\n      </div>\n\n      <div className=\"mt-2 flex flex-wrap gap-3 px-1 text-[11px] text-zinc-500\">\n        <div className=\"flex items-center gap-1\">\n          <span className=\"h-2 w-2 rounded-full bg-sky-500\" /> высокий тариф\n        </div>\n        <div className=\"flex items-center gap-1\">\n          <span className=\"h-2 w-2 rounded-full bg-red-500\" /> горящие слоты\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAae,SAAS,QAAQ,EAAE,IAAI,EAAE,KAAK,EAAE,QAAQ,EAAE,OAAO,EAAE,WAAW,EAAS;IACpF,qBACE,6TAAC;QAAI,WAAU;;0BACb,6TAAC;gBAAI,WAAU;0BACZ,KAAK,GAAG,CAAC,CAAC;oBACT,MAAM,SAAS,QAAQ;oBACvB,MAAM,QAAQ,SAAS,IAAI;oBAC3B,MAAM,YAAY,aAAa,IAAI;oBAEnC,qBACE,6TAAC;wBAEC,SAAS,IAAM,SAAS;wBACxB,WAAW,IAAA,kHAAE,EACX,yFACA,SACI,2CACA;;0CAIN,6TAAC;gCAAI,WAAU;;oCACZ,0BACC,6TAAC;wCACC,WAAW,IAAA,kHAAE,EAAC,wBAAwB,SAAS,eAAe;wCAC9D,cAAW;wCACX,OAAM;;;;;+CAEN;oCACH,sBACC,6TAAC;wCACC,WAAW,IAAA,kHAAE,EAAC,wBAAwB,SAAS,eAAe;wCAC9D,cAAW;wCACX,OAAM;;;;;+CAEN;;;;;;;0CAGN,6TAAC;gCAAI,WAAW,IAAA,kHAAE,EAAC,WAAW,SAAS,kBAAkB;0CACtD,IAAA,uIAAoB,EAAC;;;;;;0CAExB,6TAAC;gCAAI,WAAU;0CAAgC,IAAA,mIAAgB,EAAC;;;;;;;uBA9B3D;;;;;gBAiCX;;;;;;0BAGF,6TAAC;gBAAI,WAAU;;kCACb,6TAAC;wBAAI,WAAU;;0CACb,6TAAC;gCAAK,WAAU;;;;;;4BAAoC;;;;;;;kCAEtD,6TAAC;wBAAI,WAAU;;0CACb,6TAAC;gCAAK,WAAU;;;;;;4BAAoC;;;;;;;;;;;;;;;;;;;AAK9D;KAzDwB"}},
    {"offset": {"line": 248, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/smenuberu-web/components/badge.tsx"],"sourcesContent":["export default function Badge({ children }: { children: React.ReactNode }) {\n  return (\n    <span className=\"inline-flex items-center rounded-full border border-zinc-200 bg-white px-2.5 py-1 text-xs text-zinc-700\">\n      {children}\n    </span>\n  );\n}\n"],"names":[],"mappings":";;;;;;AAAe,SAAS,MAAM,EAAE,QAAQ,EAAiC;IACvE,qBACE,6TAAC;QAAK,WAAU;kBACb;;;;;;AAGP;KANwB"}},
    {"offset": {"line": 274, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/smenuberu-web/lib/booking-state.ts"],"sourcesContent":["export type BookingStatus = \"none\" | \"booked\" | \"cancelled\" | \"completed\";\n\nexport type BookingRecord = {\n  status: BookingStatus;\n  updatedAt: number;\n};\n\nconst key = (slotId: string) => `slot_booking_${slotId}`;\n\nexport function getBooking(slotId: string): BookingRecord {\n  if (typeof window === \"undefined\") return { status: \"none\", updatedAt: 0 };\n\n  const raw = window.localStorage.getItem(key(slotId));\n  if (!raw) return { status: \"none\", updatedAt: 0 };\n\n  try {\n    const parsed = JSON.parse(raw) as BookingRecord;\n    if (!parsed?.status) return { status: \"none\", updatedAt: 0 };\n    return parsed;\n  } catch {\n    // старый формат (если был \"booked\" строкой)\n    if (raw === \"booked\") return { status: \"booked\", updatedAt: Date.now() };\n    return { status: \"none\", updatedAt: 0 };\n  }\n}\n\nexport function setBooking(slotId: string, status: BookingStatus) {\n  if (typeof window === \"undefined\") return;\n  const rec: BookingRecord = { status, updatedAt: Date.now() };\n  window.localStorage.setItem(key(slotId), JSON.stringify(rec));\n}\n"],"names":[],"mappings":";;;;;;AAOA,MAAM,MAAM,CAAC,SAAmB,CAAC,aAAa,EAAE,QAAQ;AAEjD,SAAS,WAAW,MAAc;IACvC;;IAEA,MAAM,MAAM,OAAO,YAAY,CAAC,OAAO,CAAC,IAAI;IAC5C,IAAI,CAAC,KAAK,OAAO;QAAE,QAAQ;QAAQ,WAAW;IAAE;IAEhD,IAAI;QACF,MAAM,SAAS,KAAK,KAAK,CAAC;QAC1B,IAAI,CAAC,QAAQ,QAAQ,OAAO;YAAE,QAAQ;YAAQ,WAAW;QAAE;QAC3D,OAAO;IACT,EAAE,OAAM;QACN,4CAA4C;QAC5C,IAAI,QAAQ,UAAU,OAAO;YAAE,QAAQ;YAAU,WAAW,KAAK,GAAG;QAAG;QACvE,OAAO;YAAE,QAAQ;YAAQ,WAAW;QAAE;IACxC;AACF;AAEO,SAAS,WAAW,MAAc,EAAE,MAAqB;IAC9D;;IACA,MAAM,MAAqB;QAAE;QAAQ,WAAW,KAAK,GAAG;IAAG;IAC3D,OAAO,YAAY,CAAC,OAAO,CAAC,IAAI,SAAS,KAAK,SAAS,CAAC;AAC1D"}},
    {"offset": {"line": 324, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/smenuberu-web/lib/rating-state.ts"],"sourcesContent":["export type RatingRecord = {\n  stars: 1 | 2 | 3 | 4 | 5;\n  comment?: string;\n  updatedAt: number;\n};\n\nconst key = (slotId: string) => `slot_rating_${slotId}`;\n\nexport function getRating(slotId: string): RatingRecord | null {\n  if (typeof window === \"undefined\") return null;\n  const raw = window.localStorage.getItem(key(slotId));\n  if (!raw) return null;\n  try {\n    return JSON.parse(raw) as RatingRecord;\n  } catch {\n    return null;\n  }\n}\n\nexport function setRating(slotId: string, stars: 1 | 2 | 3 | 4 | 5, comment?: string) {\n  if (typeof window === \"undefined\") return;\n  const rec: RatingRecord = { stars, comment, updatedAt: Date.now() };\n  window.localStorage.setItem(key(slotId), JSON.stringify(rec));\n}\n"],"names":[],"mappings":";;;;;;AAMA,MAAM,MAAM,CAAC,SAAmB,CAAC,YAAY,EAAE,QAAQ;AAEhD,SAAS,UAAU,MAAc;IACtC;;IACA,MAAM,MAAM,OAAO,YAAY,CAAC,OAAO,CAAC,IAAI;IAC5C,IAAI,CAAC,KAAK,OAAO;IACjB,IAAI;QACF,OAAO,KAAK,KAAK,CAAC;IACpB,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,SAAS,UAAU,MAAc,EAAE,KAAwB,EAAE,OAAgB;IAClF;;IACA,MAAM,MAAoB;QAAE;QAAO;QAAS,WAAW,KAAK,GAAG;IAAG;IAClE,OAAO,YAAY,CAAC,OAAO,CAAC,IAAI,SAAS,KAAK,SAAS,CAAC;AAC1D"}},
    {"offset": {"line": 359, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/smenuberu-web/components/slot-card.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport Badge from \"@/components/badge\";\nimport type { Slot } from \"@/lib/slots\";\nimport { formatMoneyRub } from \"@/lib/slots\";\nimport { getBooking, setBooking, type BookingStatus } from \"@/lib/booking-state\";\nimport { getRating } from \"@/lib/rating-state\";\n\nexport default function SlotCard({\n  slot,\n  onBook,\n  onRate\n}: {\n  slot: Slot;\n  onBook: (slot: Slot) => void;\n  onRate: (slot: Slot) => void;\n}) {\n  const [status, setStatus] = useState<BookingStatus>(\"none\");\n  const [hasRating, setHasRating] = useState(false);\n\n  useEffect(() => {\n    const rec = getBooking(slot.id);\n    setStatus(rec.status);\n    setHasRating(!!getRating(slot.id));\n  }, [slot.id]);\n\n  const isPremium = slot.pay >= 3500;\n\n  return (\n    <div className=\"rounded-2xl border border-zinc-200 bg-white p-5\">\n      <div className=\"flex items-start justify-between gap-3\">\n        <div>\n          <div className=\"flex flex-wrap items-center gap-2\">\n            <div className=\"text-base font-semibold\">{slot.title}</div>\n\n            {slot.hot ? (\n              <span className=\"inline-flex items-center rounded-full bg-red-50 px-2 py-0.5 text-xs font-medium text-red-700\">\n                Горящий\n              </span>\n            ) : null}\n\n            {isPremium ? (\n              <span className=\"inline-flex items-center rounded-full bg-sky-50 px-2 py-0.5 text-xs font-medium text-sky-700\">\n                Высокий тариф\n              </span>\n            ) : null}\n\n            {status === \"booked\" ? (\n              <span className=\"inline-flex items-center rounded-full bg-emerald-50 px-2 py-0.5 text-xs font-medium text-emerald-700\">\n                Записан\n              </span>\n            ) : null}\n\n            {status === \"cancelled\" ? (\n              <span className=\"inline-flex items-center rounded-full bg-zinc-100 px-2 py-0.5 text-xs font-medium text-zinc-600\">\n                Отменено\n              </span>\n            ) : null}\n\n            {status === \"completed\" ? (\n              <span className=\"inline-flex items-center rounded-full bg-zinc-900 px-2 py-0.5 text-xs font-medium text-white\">\n                Завершено\n              </span>\n            ) : null}\n\n            {hasRating ? (\n              <span className=\"inline-flex items-center rounded-full bg-amber-50 px-2 py-0.5 text-xs font-medium text-amber-700\">\n                Оценено\n              </span>\n            ) : null}\n          </div>\n\n          <div className=\"mt-1 text-sm text-zinc-600\">\n            {slot.company} · {slot.city}\n          </div>\n        </div>\n\n        <div className=\"text-right\">\n          <div className=\"text-base font-semibold\">{formatMoneyRub(slot.pay)}</div>\n          <div className=\"mt-1 text-xs text-zinc-500\">{slot.time}</div>\n        </div>\n      </div>\n\n      <div className=\"mt-3 flex flex-wrap gap-2\">\n        {slot.tags.map((t) => (\n          <Badge key={t}>{t}</Badge>\n        ))}\n      </div>\n\n      <div className=\"mt-3 text-sm text-zinc-600\">{slot.address}</div>\n\n      {/* действия */}\n      {status === \"booked\" ? (\n        <div className=\"mt-4 grid gap-2\">\n          <button\n            onClick={() => {\n              setBooking(slot.id, \"cancelled\");\n              setStatus(\"cancelled\");\n            }}\n            className=\"inline-flex w-full items-center justify-center rounded-xl border border-zinc-200 bg-white px-4 py-3 text-sm font-medium text-zinc-900\"\n          >\n            Отменить запись\n          </button>\n\n          {/* DEMO: завершить, чтобы включить рейтинг */}\n          <button\n            onClick={() => {\n              setBooking(slot.id, \"completed\");\n              setStatus(\"completed\");\n            }}\n            className=\"inline-flex w-full items-center justify-center rounded-xl bg-zinc-900 px-4 py-3 text-sm font-medium text-white\"\n          >\n            Отметить как завершено (demo)\n          </button>\n        </div>\n      ) : status === \"completed\" ? (\n        <div className=\"mt-4 grid gap-2\">\n          <button\n            onClick={() => onRate(slot)}\n            className=\"inline-flex w-full items-center justify-center rounded-xl bg-zinc-900 px-4 py-3 text-sm font-medium text-white\"\n          >\n            Оценить смену\n          </button>\n        </div>\n      ) : (\n        <button\n          onClick={() => onBook(slot)}\n          className=\"mt-4 inline-flex w-full items-center justify-center rounded-xl bg-zinc-900 px-4 py-3 text-sm font-medium text-white\"\n        >\n          Записаться\n        </button>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAEA;AACA;AACA;;;AAPA;;;;;;AASe,SAAS,SAAS,EAC/B,IAAI,EACJ,MAAM,EACN,MAAM,EAKP;;IACC,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,ySAAQ,EAAgB;IACpD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,ySAAQ,EAAC;IAE3C,IAAA,0SAAS;8BAAC;YACR,MAAM,MAAM,IAAA,wIAAU,EAAC,KAAK,EAAE;YAC9B,UAAU,IAAI,MAAM;YACpB,aAAa,CAAC,CAAC,IAAA,sIAAS,EAAC,KAAK,EAAE;QAClC;6BAAG;QAAC,KAAK,EAAE;KAAC;IAEZ,MAAM,YAAY,KAAK,GAAG,IAAI;IAE9B,qBACE,6TAAC;QAAI,WAAU;;0BACb,6TAAC;gBAAI,WAAU;;kCACb,6TAAC;;0CACC,6TAAC;gCAAI,WAAU;;kDACb,6TAAC;wCAAI,WAAU;kDAA2B,KAAK,KAAK;;;;;;oCAEnD,KAAK,GAAG,iBACP,6TAAC;wCAAK,WAAU;kDAA+F;;;;;+CAG7G;oCAEH,0BACC,6TAAC;wCAAK,WAAU;kDAA+F;;;;;+CAG7G;oCAEH,WAAW,yBACV,6TAAC;wCAAK,WAAU;kDAAuG;;;;;+CAGrH;oCAEH,WAAW,4BACV,6TAAC;wCAAK,WAAU;kDAAkG;;;;;+CAGhH;oCAEH,WAAW,4BACV,6TAAC;wCAAK,WAAU;kDAA+F;;;;;+CAG7G;oCAEH,0BACC,6TAAC;wCAAK,WAAU;kDAAmG;;;;;+CAGjH;;;;;;;0CAGN,6TAAC;gCAAI,WAAU;;oCACZ,KAAK,OAAO;oCAAC;oCAAI,KAAK,IAAI;;;;;;;;;;;;;kCAI/B,6TAAC;wBAAI,WAAU;;0CACb,6TAAC;gCAAI,WAAU;0CAA2B,IAAA,iIAAc,EAAC,KAAK,GAAG;;;;;;0CACjE,6TAAC;gCAAI,WAAU;0CAA8B,KAAK,IAAI;;;;;;;;;;;;;;;;;;0BAI1D,6TAAC;gBAAI,WAAU;0BACZ,KAAK,IAAI,CAAC,GAAG,CAAC,CAAC,kBACd,6TAAC,kIAAK;kCAAU;uBAAJ;;;;;;;;;;0BAIhB,6TAAC;gBAAI,WAAU;0BAA8B,KAAK,OAAO;;;;;;YAGxD,WAAW,yBACV,6TAAC;gBAAI,WAAU;;kCACb,6TAAC;wBACC,SAAS;4BACP,IAAA,wIAAU,EAAC,KAAK,EAAE,EAAE;4BACpB,UAAU;wBACZ;wBACA,WAAU;kCACX;;;;;;kCAKD,6TAAC;wBACC,SAAS;4BACP,IAAA,wIAAU,EAAC,KAAK,EAAE,EAAE;4BACpB,UAAU;wBACZ;wBACA,WAAU;kCACX;;;;;;;;;;;uBAID,WAAW,4BACb,6TAAC;gBAAI,WAAU;0BACb,cAAA,6TAAC;oBACC,SAAS,IAAM,OAAO;oBACtB,WAAU;8BACX;;;;;;;;;;qCAKH,6TAAC;gBACC,SAAS,IAAM,OAAO;gBACtB,WAAU;0BACX;;;;;;;;;;;;AAMT;GA9HwB;KAAA"}},
    {"offset": {"line": 609, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/smenuberu-web/components/booking-modal.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useMemo, useState } from \"react\";\nimport DayTabs from \"@/components/day-tabs\";\nimport type { Slot } from \"@/lib/slots\";\nimport { getBooking, setBooking } from \"@/lib/booking-state\";\nimport { formatMoneyRub } from \"@/lib/slots\";\n\ntype Range = { start: number; end: number }; // minutes\n\nfunction parseRangeMinutes(timeRange: string): Range {\n  // \"08:00–15:00\"\n  const [aRaw, bRaw] = timeRange.split(\"–\").map((x) => x.trim());\n  const [ah, am] = (aRaw ?? \"00:00\").split(\":\").map(Number);\n  const [bh, bm] = (bRaw ?? \"00:00\").split(\":\").map(Number);\n  const start = (ah || 0) * 60 + (am || 0);\n  const end = (bh || 0) * 60 + (bm || 0);\n  return { start, end };\n}\n\nfunction overlaps(a: Range, b: Range) {\n  return a.start < b.end && b.start < a.end;\n}\n\nexport default function BookingModal({\n  open,\n  onClose,\n  days,\n  slots,\n  hotDays,\n  premiumDays,\n  initialDay,\n  initialTitle\n}: {\n  open: boolean;\n  onClose: () => void;\n  days: string[];\n  slots: Slot[];\n  hotDays: Set<string>;\n  premiumDays: Set<string>;\n  initialDay: string;\n  initialTitle?: string;\n}) {\n  const [day, setDay] = useState(initialDay);\n  const [selected, setSelected] = useState<string[]>([]);\n  const [onlyConsecutive, setOnlyConsecutive] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  // reset при открытии\n  useEffect(() => {\n    if (open) {\n      setDay(initialDay);\n      setSelected([]);\n      setOnlyConsecutive(true);\n      setError(null);\n    }\n  }, [open, initialDay]);\n\n  const daySlots = useMemo(() => {\n    const list = slots.filter((s) => s.date === day);\n    return list.sort((a, b) => parseRangeMinutes(a.time).start - parseRangeMinutes(b.time).start);\n  }, [slots, day]);\n\n  const idsOrdered = useMemo(() => daySlots.map((s) => s.id), [daySlots]);\n\n  const daySlotById = useMemo(() => {\n    const m = new Map<string, Slot>();\n    for (const s of daySlots) m.set(s.id, s);\n    return m;\n  }, [daySlots]);\n\n  const selectedSlots = useMemo(\n    () => selected.map((id) => daySlotById.get(id)).filter(Boolean) as Slot[],\n    [selected, daySlotById]\n  );\n\n  const totalPay = useMemo(() => selectedSlots.reduce((sum, s) => sum + s.pay, 0), [selectedSlots]);\n\n  const isBooked = (slotId: string) => getBooking(slotId) === \"booked\";\n\n  // ЧИСТАЯ проверка: можно ли добавить слот без пересечений с выбранными/уже забронированными\n  const canSelectWithoutOverlap = (slotId: string) => {\n    const slot = daySlotById.get(slotId);\n    if (!slot) return false;\n\n    const r = parseRangeMinutes(slot.time);\n\n    // 1) не пересекаться с выбранными\n    for (const sid of selected) {\n      if (sid === slotId) continue;\n      const other = daySlotById.get(sid);\n      if (!other) continue;\n      if (overlaps(r, parseRangeMinutes(other.time))) return false;\n    }\n\n    // 2) не пересекаться с уже booked в этот день\n    for (const s of daySlots) {\n      if (!isBooked(s.id)) continue;\n      if (s.id === slotId) continue;\n      if (overlaps(r, parseRangeMinutes(s.time))) return false;\n    }\n\n    return true;\n  };\n\n  // ЧИСТАЯ проверка: режим “подряд” (только соседние по списку)\n  const canAddConsecutive = (slotId: string) => {\n    if (!onlyConsecutive) return true;\n    if (selected.length === 0) return true;\n\n    const idx = idsOrdered.indexOf(slotId);\n    if (idx === -1) return false;\n\n    const selectedIdxs = selected\n      .map((x) => idsOrdered.indexOf(x))\n      .filter((x) => x >= 0)\n      .sort((a, b) => a - b);\n\n    const min = selectedIdxs[0];\n    const max = selectedIdxs[selectedIdxs.length - 1];\n    return idx === min - 1 || idx === max + 1;\n  };\n\n  // ЧИСТАЯ проверка: можно ли выбрать (не booked, не пересекается, и подряд если включено)\n  const canSelect = (slotId: string) => {\n    if (selected.includes(slotId)) return true; // снятие разрешаем всегда\n    if (isBooked(slotId)) return false;\n    if (!canSelectWithoutOverlap(slotId)) return false;\n    if (!canAddConsecutive(slotId)) return false;\n    return true;\n  };\n\n  const toggle = (slotId: string) => {\n    setSelected((prev) => {\n      // снять\n      if (prev.includes(slotId)) {\n        setError(null);\n        return prev.filter((x) => x !== slotId);\n      }\n\n      // добавить\n      if (!canSelect(slotId)) {\n        // объясняем причину\n        if (isBooked(slotId)) {\n          setError(\"Этот слот уже забронирован.\");\n        } else if (!canSelectWithoutOverlap(slotId)) {\n          setError(\"Нельзя выбрать: слот пересекается по времени с выбранным или уже забронированным.\");\n        } else if (!canAddConsecutive(slotId)) {\n          setError(\"В режиме “подряд” можно добавлять только соседние слоты (слева/справа).\");\n        } else {\n          setError(\"Нельзя выбрать этот слот.\");\n        }\n        return prev;\n      }\n\n      setError(null);\n      return [...prev, slotId];\n    });\n  };\n\n  if (!open) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-50\">\n      <div className=\"absolute inset-0 bg-black/40\" onClick={onClose} />\n      <div className=\"absolute left-1/2 top-4 w-[min(560px,calc(100%-16px))] -translate-x-1/2\">\n        <div className=\"rounded-2xl border border-zinc-200 bg-white shadow-lg\">\n          <div className=\"flex items-start justify-between gap-3 border-b border-zinc-200 p-4\">\n            <div>\n              <div className=\"text-sm text-zinc-500\">Запись на слоты</div>\n              <div className=\"text-base font-semibold\">{initialTitle ?? \"Выбери дату и слоты\"}</div>\n            </div>\n            <button onClick={onClose} className=\"rounded-xl border border-zinc-200 bg-white px-3 py-2 text-sm\">\n              Закрыть\n            </button>\n          </div>\n\n          <div className=\"space-y-3 p-4\">\n            <DayTabs\n              days={days}\n              value={day}\n              onChange={(d) => {\n                setDay(d);\n                setSelected([]);\n                setError(null);\n              }}\n              hotDays={hotDays}\n              premiumDays={premiumDays}\n            />\n\n            <div className=\"flex items-center justify-between gap-3 rounded-2xl border border-zinc-200 bg-white p-3\">\n              <div>\n                <div className=\"text-sm font-medium\">Выбирать “подряд”</div>\n                <div className=\"text-xs text-zinc-500\">Вкл — только соседние слоты, плюс запрет пересечений по времени.</div>\n              </div>\n              <button\n                onClick={() => {\n                  setOnlyConsecutive((v) => !v);\n                  setSelected([]);\n                  setError(null);\n                }}\n                className=\"rounded-xl border border-zinc-200 bg-white px-3 py-2 text-sm\"\n              >\n                {onlyConsecutive ? \"Вкл\" : \"Выкл\"}\n              </button>\n            </div>\n\n            {error ? (\n              <div className=\"rounded-2xl border border-rose-200 bg-rose-50 p-3 text-sm text-rose-800\">\n                {error}\n              </div>\n            ) : null}\n\n            {daySlots.length === 0 ? (\n              <div className=\"rounded-2xl border border-zinc-200 bg-white p-4 text-sm text-zinc-600\">\n                На этот день слотов нет. Листай табы сверху.\n              </div>\n            ) : (\n              <div className=\"space-y-2\">\n                {daySlots.map((s) => {\n                  const checked = selected.includes(s.id);\n                  const booked = isBooked(s.id);\n\n                  // ВАЖНО: canSelect() ЧИСТАЯ и НЕ setState\n                  const disabled = !checked && !canSelect(s.id);\n\n                  return (\n                    <button\n                      key={s.id}\n                      onClick={() => toggle(s.id)}\n                      disabled={disabled}\n                      className={[\n                        \"w-full rounded-2xl border p-4 text-left transition\",\n                        checked ? \"border-zinc-900 bg-zinc-50\" : \"border-zinc-200 hover:bg-zinc-50\",\n                        disabled ? \"opacity-50 cursor-not-allowed\" : \"\"\n                      ].join(\" \")}\n                      title={booked ? \"Уже записан на этот слот\" : undefined}\n                    >\n                      <div className=\"flex items-start justify-between gap-3\">\n                        <div>\n                          <div className=\"flex items-center gap-2\">\n                            <span\n                              className={[\n                                \"inline-flex h-5 w-5 items-center justify-center rounded-md border text-xs\",\n                                checked ? \"border-zinc-900 bg-zinc-900 text-white\" : \"border-zinc-300 bg-white\"\n                              ].join(\" \")}\n                            >\n                              {checked ? \"✓\" : \"\"}\n                            </span>\n\n                            <div className=\"font-semibold\">\n                              {s.title}\n                              {s.hot ? <span className=\"ml-2 text-xs text-red-600\">• горячий</span> : null}\n                              {s.pay >= 3500 ? <span className=\"ml-2 text-xs text-sky-700\">• высокий тариф</span> : null}\n                              {booked ? <span className=\"ml-2 text-xs text-emerald-700\">• уже записан</span> : null}\n                            </div>\n                          </div>\n\n                          <div className=\"mt-1 text-sm text-zinc-600\">\n                            {s.company} · {s.city}\n                          </div>\n                        </div>\n\n                        <div className=\"text-right\">\n                          <div className=\"text-sm font-semibold\">{s.time}</div>\n                          <div className=\"text-xs text-zinc-500\">{formatMoneyRub(s.pay)}</div>\n                        </div>\n                      </div>\n                    </button>\n                  );\n                })}\n              </div>\n            )}\n\n            <div className=\"rounded-2xl border border-zinc-200 bg-white p-4 text-sm\">\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-zinc-600\">Выбрано слотов:</span>\n                <span className=\"font-semibold\">{selected.length}</span>\n              </div>\n              <div className=\"mt-1 flex items-center justify-between\">\n                <span className=\"text-zinc-600\">Итого оплата:</span>\n                <span className=\"font-semibold\">{formatMoneyRub(totalPay)}</span>\n              </div>\n            </div>\n\n            <button\n              disabled={selected.length === 0}\n              onClick={() => {\n                // финальная проверка пересечений внутри selected (на всякий)\n                const ranges = selectedSlots.map((s) => ({ id: s.id, r: parseRangeMinutes(s.time) }));\n                for (let i = 0; i < ranges.length; i++) {\n                  for (let j = i + 1; j < ranges.length; j++) {\n                    if (overlaps(ranges[i].r, ranges[j].r)) {\n                      setError(\"Есть пересекающиеся по времени слоты. Убери конфликт и попробуй снова.\");\n                      return;\n                    }\n                  }\n                }\n\n                for (const id of selected) setBooking(id, \"booked\");\n                onClose();\n              }}\n              className=\"inline-flex w-full items-center justify-center rounded-xl bg-zinc-900 px-4 py-3 text-sm font-medium text-white disabled:opacity-50\"\n            >\n              Подтвердить запись ({selected.length})\n            </button>\n\n            <div className=\"text-xs text-zinc-500\">\n              UI-only: бронь сохраняется в localStorage. Пересечения по времени запрещены.\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1177, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/smenuberu-web/app/shifts/shifts-client.tsx"],"sourcesContent":["\"use client\";\n\nimport { useCallback, useEffect, useMemo, useState } from \"react\";\nimport DayTabs from \"@/components/day-tabs\";\nimport SlotCard from \"@/components/slot-card\";\nimport BookingModal from \"@/components/booking-modal\";\nimport { addDays, getMockSlots, toISODateLocal } from \"@/lib/slots\";\nimport type { Slot } from \"@/lib/slots\";\n\nfunction getDaysWindow(from: Date, windowDays = 14) {\n  const out: string[] = [];\n  for (let i = 0; i < windowDays; i++) out.push(toISODateLocal(addDays(from, i)));\n  return out;\n}\n\n// авто-обновление “сегодня” в полночь\nfunction useAutoTodayRollover(onRollover: (now: Date) => void) {\n  useEffect(() => {\n    const tick = () => onRollover(new Date());\n\n    const now = new Date();\n    const nextMidnight = new Date(\n      now.getFullYear(),\n      now.getMonth(),\n      now.getDate() + 1,\n      0,\n      0,\n      2\n    );\n    const msToMidnight = nextMidnight.getTime() - now.getTime();\n\n    const t1 = window.setTimeout(() => {\n      tick();\n      const t2 = window.setInterval(tick, 60_000);\n      // cleanup for interval\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      (t1 as any)._t2 = t2;\n    }, msToMidnight);\n\n    return () => {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const maybe = (t1 as any)?._t2 as number | undefined;\n      if (maybe) window.clearInterval(maybe);\n      window.clearTimeout(t1);\n    };\n  }, [onRollover]);\n}\n\nexport default function ShiftsClient() {\n  const [q, setQ] = useState(\"\");\n  const [today, setToday] = useState<Date>(() => new Date());\n  const [selectedDay, setSelectedDay] = useState<string>(() => toISODateLocal(new Date()));\n\n  // окно дней 14 дней\n  const days = useMemo(() => getDaysWindow(today, 14), [today]);\n\n  // мок-слоты на окно\n  const slots = useMemo(() => getMockSlots(today, 14), [today]);\n\n  // red notch (горящие дни)\n  const hotDays = useMemo(() => {\n    const s = new Set<string>();\n    for (const x of slots) if (x.hot) s.add(x.date);\n    return s;\n  }, [slots]);\n\n  // blue notch (высокий тариф)\n  const premiumDays = useMemo(() => {\n    const s = new Set<string>();\n    for (const x of slots) if (x.pay >= 3500) s.add(x.date);\n    return s;\n  }, [slots]);\n\n  // полночь: пересчитать today + выбрать новый \"сегодня\"\n  const handleRollover = useCallback((now: Date) => {\n    setToday(now);\n    setSelectedDay(toISODateLocal(now));\n  }, []);\n  useAutoTodayRollover(handleRollover);\n\n  // если selectedDay выпал из окна (например, после rollover) — аккуратно поправим\n  useEffect(() => {\n    if (days.length === 0) return;\n    if (!days.includes(selectedDay)) {\n      setSelectedDay(days[0]);\n    }\n  }, [days, selectedDay]);\n\n  const filtered = useMemo(() => {\n    const s = q.trim().toLowerCase();\n    return slots\n      .filter((x) => x.date === selectedDay)\n      .filter((x) => {\n        if (!s) return true;\n        return [x.title, x.company, x.city].some((v) => v.toLowerCase().includes(s));\n      });\n  }, [q, selectedDay, slots]);\n\n  // модалка\n  const [modalOpen, setModalOpen] = useState(false);\n  const [modalPreset, setModalPreset] = useState<{ day: string; title?: string } | null>(null);\n\n  const onClose = useCallback(() => setModalOpen(false), []);\n\n  const openBooking = useCallback((slot: Slot) => {\n    setModalPreset({ day: slot.date, title: slot.title });\n    setModalOpen(true);\n  }, []);\n\n  return (\n    <div className=\"space-y-4\">\n      <DayTabs\n        days={days}\n        value={selectedDay}\n        onChange={setSelectedDay}\n        hotDays={hotDays}\n        premiumDays={premiumDays}\n      />\n\n      <div className=\"rounded-2xl border border-zinc-200 bg-white p-4\">\n        <input\n          value={q}\n          onChange={(e) => setQ(e.target.value)}\n          placeholder=\"Поиск: профессия, компания, город…\"\n          className=\"w-full rounded-xl border border-zinc-200 bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-zinc-900/10\"\n        />\n      </div>\n\n      {filtered.length === 0 ? (\n        <div className=\"rounded-2xl border border-zinc-200 bg-white p-5 text-sm text-zinc-600\">\n          На выбранную дату слотов нет. Листай дни табами сверху.\n        </div>\n      ) : (\n        <div className=\"space-y-3\">\n          {filtered.map((slot) => (\n            <SlotCard key={slot.id} slot={slot} onBook={openBooking} />\n          ))}\n        </div>\n      )}\n\n      <BookingModal\n        open={modalOpen}\n        onClose={onClose}\n        days={days}\n        slots={slots}\n        hotDays={hotDays}\n        premiumDays={premiumDays}\n        initialDay={modalPreset?.day ?? selectedDay}\n        initialTitle={modalPreset?.title}\n      />\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}